language: node_js
cache: npm
git:
  depth: 3

stages:
  - lint
  - test
  - name: deploy
    if: branch = main

jobs:
  include:
    - name: Lint code
      stage: lint
      script: npm run lint
    - name: Run tests
      stage: test
      script: npm run test:cover
      after_success: npm run coveralls
    - name: Deploy to AWS Lambda
      stage: deploy
      script: skip
      deploy: &lambda
        provider: lambda
        region: us-west-1
        runtime: nodejs12.x
        function_name: deploy-lambda-travis
        handler_name: hello
        role: arn:aws:iam::673233482676:role/service-role/lambda_basic_execution
        on:
          branch: main

notifications:
  email: false
  slack:
    if: branch = master
    rooms:
      - $NOTIFICATIONS_SLACK
